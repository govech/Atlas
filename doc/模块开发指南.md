# Atlas Android Framework 模块开发指南

## 1. 概述

本指南详细说明如何在Atlas Android Framework中创建和开发新的功能模块，包括模块结构、依赖配置、开发流程等。

### 1.1 模块类型

Atlas框架支持以下类型的模块：

- **功能模块 (feature-*)**: 具体业务功能实现
- **核心模块 (core-*)**: 基础设施和通用组件
- **应用模块 (app)**: 应用入口和集成

### 1.2 模块设计原则

- **单一职责**: 每个模块只负责一个明确的功能领域
- **低耦合**: 模块间依赖关系清晰，避免循环依赖
- **高内聚**: 模块内部组件紧密协作
- **可测试**: 支持独立的单元测试和集成测试

## 2. 功能模块开发

### 2.1 创建新的功能模块

#### 2.1.1 使用Android Studio创建模块

1. 右键点击项目根目录
2. 选择 New → Module
3. 选择 "Android Library"
4. 模块名称格式：`feature-{功能名}`
5. 包名格式：`com.sword.atlas.feature.{功能名}`

#### 2.1.2 手动创建模块

```bash
# 1. 创建模块目录
mkdir feature-example

# 2. 创建标准目录结构
mkdir -p feature-example/src/main/java/com/sword/atlas/feature/example
mkdir -p feature-example/src/main/res/layout
mkdir -p feature-example/src/main/res/values
mkdir -p feature-example/src/test/java
mkdir -p feature-example/src/androidTest/java

# 3. 创建构建脚本
touch feature-example/build.gradle.kts
```

#### 2.1.3 配置settings.gradle.kts

在项目根目录的`settings.gradle.kts`中添加新模块：

```kotlin
include(":feature-example")
```

### 2.2 功能模块标准结构

```
feature-example/
├── src/
│   ├── main/
│   │   ├── java/com/sword/atlas/feature/example/
│   │   │   ├── data/                    # 数据层
│   │   │   │   ├── api/                 # API接口定义
│   │   │   │   │   └── ExampleApi.kt
│   │   │   │   ├── model/               # 数据传输对象
│   │   │   │   │   ├── ExampleRequest.kt
│   │   │   │   │   └── ExampleResponse.kt
│   │   │   │   └── repository/          # 数据仓库实现
│   │   │   │       └── ExampleRepository.kt
│   │   │   ├── domain/                  # 领域层（可选）
│   │   │   │   ├── usecase/             # 业务用例
│   │   │   │   │   └── GetExampleUseCase.kt
│   │   │   │   └── model/               # 领域模型
│   │   │   │       └── Example.kt
│   │   │   ├── ui/                      # 表现层
│   │   │   │   ├── list/                # 列表功能
│   │   │   │   │   ├── ExampleListFragment.kt
│   │   │   │   │   ├── ExampleListViewModel.kt
│   │   │   │   │   └── ExampleListAdapter.kt
│   │   │   │   └── detail/              # 详情功能
│   │   │   │       ├── ExampleDetailActivity.kt
│   │   │   │       └── ExampleDetailViewModel.kt
│   │   │   └── di/                      # 依赖注入
│   │   │       └── ExampleModule.kt
│   │   └── res/
│   │       ├── layout/
│   │       │   ├── fragment_example_list.xml
│   │       │   ├── activity_example_detail.xml
│   │       │   └── item_example.xml
│   │       └── values/
│   │           └── strings.xml
│   ├── test/                            # 单元测试
│   │   └── java/com/sword/atlas/feature/example/
│   │       ├── repository/
│   │       │   └── ExampleRepositoryTest.kt
│   │       └── ui/
│   │           └── ExampleViewModelTest.kt
│   └── androidTest/                     # 集成测试
│       └── java/com/sword/atlas/feature/example/
│           └── ui/
│               └── ExampleListFragmentTest.kt
├── build.gradle.kts                     # 构建配置
└── proguard-rules.pro                   # 混淆规则
```

### 2.3 构建配置模板

创建`feature-example/build.gradle.kts`：

```kotlin
plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.hilt)
    kotlin("kapt")
}

android {
    namespace = "com.sword.atlas.feature.example"
    compileSdk = libs.versions.compileSdk.get().toInt()

    defaultConfig {
        minSdk = libs.versions.minSdk.get().toInt()
        
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles("consumer-rules.pro")
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    // 核心模块依赖
    implementation(project(":core-ui"))
    implementation(project(":core-network"))
    implementation(project(":core-database"))
    implementation(project(":core-model"))
    implementation(project(":core-common"))

    // AndroidX 核心库
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.viewmodel.ktx)
    implementation(libs.androidx.lifecycle.livedata.ktx)
    implementation(libs.androidx.fragment.ktx)

    // 协程
    implementation(libs.kotlinx.coroutines.android)

    // 依赖注入
    implementation(libs.hilt.android)
    kapt(libs.hilt.compiler)

    // UI 组件
    implementation(libs.androidx.recyclerview)
    implementation(libs.material)

    // 测试依赖
    testImplementation(libs.junit)
    testImplementation(libs.mockito.core)
    testImplementation(libs.kotlinx.coroutines.test)
    
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(libs.hilt.android.testing)
    kaptAndroidTest(libs.hilt.compiler)
}
```## 3. 模块模板
实现

### 3.1 数据层实现

#### 3.1.1 API接口定义

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/data/api/ExampleApi.kt
interface ExampleApi {
    
    @GET("examples")
    suspend fun getExampleList(
        @Query("page") page: Int,
        @Query("size") size: Int
    ): ApiResponse<PageData<ExampleDto>>
    
    @GET("examples/{id}")
    suspend fun getExampleById(
        @Path("id") id: Long
    ): ApiResponse<ExampleDto>
    
    @POST("examples")
    suspend fun createExample(
        @Body request: CreateExampleRequest
    ): ApiResponse<ExampleDto>
    
    @PUT("examples/{id}")
    suspend fun updateExample(
        @Path("id") id: Long,
        @Body request: UpdateExampleRequest
    ): ApiResponse<ExampleDto>
    
    @DELETE("examples/{id}")
    suspend fun deleteExample(
        @Path("id") id: Long
    ): ApiResponse<Unit>
}
```

#### 3.1.2 数据模型定义

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/data/model/ExampleDto.kt
data class ExampleDto(
    val id: Long,
    val title: String,
    val description: String?,
    val status: Int,
    val createdAt: String,
    val updatedAt: String
) {
    fun toExample(): Example {
        return Example(
            id = id,
            title = title,
            description = description,
            status = ExampleStatus.fromValue(status),
            createdAt = DateUtil.parseIso8601(createdAt),
            updatedAt = DateUtil.parseIso8601(updatedAt)
        )
    }
}

data class CreateExampleRequest(
    val title: String,
    val description: String?
)

data class UpdateExampleRequest(
    val title: String,
    val description: String?,
    val status: Int
)
```

#### 3.1.3 Repository实现

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/data/repository/ExampleRepository.kt
class ExampleRepository @Inject constructor(
    private val api: ExampleApi,
    private val exampleDao: ExampleDao
) : BaseRepository() {

    fun getExampleListFlow(refresh: Boolean = false): Flow<Result<List<Example>>> = flow {
        emit(Result.Loading)
        
        // 先发射本地数据
        if (!refresh) {
            val localData = exampleDao.getAllExamples().first()
            if (localData.isNotEmpty()) {
                emit(Result.Success(localData.map { it.toExample() }))
            }
        }
        
        // 请求网络数据
        try {
            val response = api.getExampleList(page = 1, size = 20)
            if (response.isSuccess()) {
                val examples = response.data?.items ?: emptyList()
                
                // 缓存到本地数据库
                exampleDao.deleteAll()
                exampleDao.insertAll(examples.map { it.toEntity() })
                
                emit(Result.Success(examples.map { it.toExample() }))
            } else {
                emit(Result.Error(response.code, response.message))
            }
        } catch (e: Exception) {
            emit(Result.Error(ErrorCode.NETWORK_ERROR, e.message ?: "网络错误"))
        }
    }.flowOn(Dispatchers.IO)

    suspend fun getExampleById(id: Long): Result<Example> {
        return executeRequest {
            api.getExampleById(id)
        }.map { it.toExample() }
    }

    suspend fun createExample(title: String, description: String?): Result<Example> {
        return executeRequest {
            api.createExample(CreateExampleRequest(title, description))
        }.map { it.toExample() }
    }

    suspend fun updateExample(
        id: Long, 
        title: String, 
        description: String?, 
        status: ExampleStatus
    ): Result<Example> {
        return executeRequest {
            api.updateExample(
                id, 
                UpdateExampleRequest(title, description, status.value)
            )
        }.map { it.toExample() }
    }

    suspend fun deleteExample(id: Long): Result<Unit> {
        return executeRequest {
            api.deleteExample(id)
        }
    }
}
```

### 3.2 领域层实现（可选）

#### 3.2.1 领域模型

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/domain/model/Example.kt
data class Example(
    val id: Long,
    val title: String,
    val description: String?,
    val status: ExampleStatus,
    val createdAt: Date,
    val updatedAt: Date
) {
    val isActive: Boolean
        get() = status == ExampleStatus.ACTIVE
        
    val displayTime: String
        get() = DateUtil.formatRelativeTime(updatedAt)
}

enum class ExampleStatus(val value: Int, val displayName: String) {
    DRAFT(0, "草稿"),
    ACTIVE(1, "激活"),
    INACTIVE(2, "停用");
    
    companion object {
        fun fromValue(value: Int): ExampleStatus {
            return values().find { it.value == value } ?: DRAFT
        }
    }
}
```

#### 3.2.2 用例实现

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/domain/usecase/GetExampleListUseCase.kt
class GetExampleListUseCase @Inject constructor(
    private val repository: ExampleRepository
) : BaseUseCase<GetExampleListUseCase.Params, List<Example>>() {

    override suspend fun execute(params: Params): Result<List<Example>> {
        return repository.getExampleListFlow(params.refresh).first()
    }

    data class Params(
        val refresh: Boolean = false
    )
}
```

### 3.3 表现层实现

#### 3.3.1 ViewModel实现

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/ui/list/ExampleListViewModel.kt
@HiltViewModel
class ExampleListViewModel @Inject constructor(
    private val repository: ExampleRepository
) : BaseViewModel() {

    private val _exampleListState = MutableStateFlow<UiState<List<Example>>>(UiState.Idle)
    val exampleListState: StateFlow<UiState<List<Example>>> = _exampleListState.asStateFlow()

    private val _refreshing = MutableStateFlow(false)
    val refreshing: StateFlow<Boolean> = _refreshing.asStateFlow()

    init {
        loadExampleList()
    }

    fun loadExampleList(refresh: Boolean = false) {
        viewModelScope.launch {
            if (refresh) {
                _refreshing.value = true
            } else {
                _exampleListState.value = UiState.Loading
            }

            repository.getExampleListFlow(refresh)
                .catch { e ->
                    _exampleListState.value = UiState.Error(
                        ErrorCode.NETWORK_ERROR,
                        e.message ?: "加载失败"
                    )
                    _refreshing.value = false
                }
                .collect { result ->
                    when (result) {
                        is Result.Success -> {
                            _exampleListState.value = UiState.Success(result.data)
                            _refreshing.value = false
                        }
                        is Result.Error -> {
                            _exampleListState.value = UiState.Error(result.code, result.message)
                            _refreshing.value = false
                        }
                        is Result.Loading -> {
                            if (!refresh) {
                                _exampleListState.value = UiState.Loading
                            }
                        }
                    }
                }
        }
    }

    fun refresh() {
        loadExampleList(refresh = true)
    }

    fun deleteExample(example: Example) {
        viewModelScope.launch {
            when (val result = repository.deleteExample(example.id)) {
                is Result.Success -> {
                    // 删除成功，刷新列表
                    loadExampleList(refresh = true)
                    showMessage("删除成功")
                }
                is Result.Error -> {
                    showError(result.message)
                }
            }
        }
    }
}
```

#### 3.3.2 Fragment实现

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/ui/list/ExampleListFragment.kt
@AndroidEntryPoint
class ExampleListFragment : BaseVMFragment<FragmentExampleListBinding, ExampleListViewModel>() {

    override val viewModel: ExampleListViewModel by viewModels()
    
    private lateinit var adapter: ExampleListAdapter

    override fun createBinding(
        inflater: LayoutInflater,
        container: ViewGroup?
    ): FragmentExampleListBinding {
        return FragmentExampleListBinding.inflate(inflater, container, false)
    }

    override fun initView() {
        setupRecyclerView()
        setupSwipeRefresh()
        setupFab()
    }

    private fun setupRecyclerView() {
        adapter = ExampleListAdapter { example ->
            // 点击事件处理
            findNavController().navigate(
                ExampleListFragmentDirections.actionToExampleDetail(example.id)
            )
        }
        
        adapter.onDeleteClick = { example ->
            showDeleteConfirmDialog(example)
        }

        binding.recyclerView.apply {
            adapter = this@ExampleListFragment.adapter
            layoutManager = LinearLayoutManager(requireContext())
            addItemDecoration(
                DividerItemDecoration(requireContext(), DividerItemDecoration.VERTICAL)
            )
        }
    }

    private fun setupSwipeRefresh() {
        binding.swipeRefreshLayout.setOnRefreshListener {
            viewModel.refresh()
        }
    }

    private fun setupFab() {
        binding.fabAdd.setOnClickListener {
            findNavController().navigate(
                ExampleListFragmentDirections.actionToCreateExample()
            )
        }
    }

    override fun observeData() {
        super.observeData()

        viewModel.exampleListState.collectOnMain(this) { state ->
            when (state) {
                is UiState.Idle -> {
                    // 初始状态
                }
                is UiState.Loading -> {
                    binding.stateLayout.showLoading()
                }
                is UiState.Success -> {
                    binding.stateLayout.showContent()
                    adapter.submitList(state.data)
                    
                    if (state.data.isEmpty()) {
                        binding.stateLayout.showEmpty("暂无数据")
                    }
                }
                is UiState.Error -> {
                    binding.stateLayout.showError(state.message) {
                        viewModel.loadExampleList()
                    }
                }
            }
        }

        viewModel.refreshing.collectOnMain(this) { refreshing ->
            binding.swipeRefreshLayout.isRefreshing = refreshing
        }
    }

    private fun showDeleteConfirmDialog(example: Example) {
        CommonDialog.Builder(requireContext())
            .setTitle("确认删除")
            .setMessage("确定要删除「${example.title}」吗？")
            .setPositiveButton("删除") {
                viewModel.deleteExample(example)
            }
            .setNegativeButton("取消")
            .show()
    }
}
```

#### 3.3.3 Adapter实现

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/ui/list/ExampleListAdapter.kt
class ExampleListAdapter(
    private val onItemClick: (Example) -> Unit
) : BaseAdapter<Example, ExampleListAdapter.ViewHolder>() {

    var onDeleteClick: ((Example) -> Unit)? = null

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val binding = ItemExampleBinding.inflate(
            LayoutInflater.from(parent.context),
            parent,
            false
        )
        return ViewHolder(binding)
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        holder.bind(getItem(position))
    }

    inner class ViewHolder(
        private val binding: ItemExampleBinding
    ) : RecyclerView.ViewHolder(binding.root) {

        fun bind(example: Example) {
            binding.apply {
                tvTitle.text = example.title
                tvDescription.text = example.description ?: "无描述"
                tvStatus.text = example.status.displayName
                tvTime.text = example.displayTime
                
                // 状态颜色
                val statusColor = when (example.status) {
                    ExampleStatus.ACTIVE -> R.color.status_active
                    ExampleStatus.INACTIVE -> R.color.status_inactive
                    ExampleStatus.DRAFT -> R.color.status_draft
                }
                tvStatus.setTextColor(ContextCompat.getColor(itemView.context, statusColor))
                
                // 点击事件
                root.setOnClickListener {
                    onItemClick(example)
                }
                
                // 删除按钮
                btnDelete.setOnClickListener {
                    onDeleteClick?.invoke(example)
                }
            }
        }
    }

    companion object {
        val DIFF_CALLBACK = object : DiffUtil.ItemCallback<Example>() {
            override fun areItemsTheSame(oldItem: Example, newItem: Example): Boolean {
                return oldItem.id == newItem.id
            }

            override fun areContentsTheSame(oldItem: Example, newItem: Example): Boolean {
                return oldItem == newItem
            }
        }
    }
}
```

### 3.4 依赖注入配置

```kotlin
// feature-example/src/main/java/com/sword/atlas/feature/example/di/ExampleModule.kt
@Module
@InstallIn(SingletonComponent::class)
object ExampleModule {

    @Provides
    @Singleton
    fun provideExampleApi(retrofit: Retrofit): ExampleApi {
        return retrofit.create(ExampleApi::class.java)
    }

    @Provides
    @Singleton
    fun provideExampleRepository(
        api: ExampleApi,
        dao: ExampleDao
    ): ExampleRepository {
        return ExampleRepository(api, dao)
    }
}

@Module
@InstallIn(ViewModelComponent::class)
object ExampleViewModelModule {

    @Provides
    fun provideGetExampleListUseCase(
        repository: ExampleRepository
    ): GetExampleListUseCase {
        return GetExampleListUseCase(repository)
    }
}
```##
# 3.5 布局文件模板

#### 3.5.1 Fragment布局

```xml
<!-- feature-example/src/main/res/layout/fragment_example_list.xml -->
<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.list.ExampleListFragment">

    <androidx.swiperefreshlayout.widget.SwipeRefreshLayout
        android:id="@+id/swipe_refresh_layout"
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <com.sword.atlas.core.ui.widget.StateLayout
            android:id="@+id/state_layout"
            android:layout_width="match_parent"
            android:layout_height="match_parent">

            <androidx.recyclerview.widget.RecyclerView
                android:id="@+id/recycler_view"
                android:layout_width="match_parent"
                android:layout_height="match_parent"
                android:clipToPadding="false"
                android:paddingTop="8dp"
                android:paddingBottom="8dp"
                tools:listitem="@layout/item_example" />

        </com.sword.atlas.core.ui.widget.StateLayout>

    </androidx.swiperefreshlayout.widget.SwipeRefreshLayout>

    <com.google.android.material.floatingactionbutton.FloatingActionButton
        android:id="@+id/fab_add"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom|end"
        android:layout_margin="16dp"
        android:src="@drawable/ic_add"
        app:tint="@android:color/white" />

</androidx.coordinatorlayout.widget.CoordinatorLayout>
```

#### 3.5.2 列表项布局

```xml
<!-- feature-example/src/main/res/layout/item_example.xml -->
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginHorizontal="16dp"
    android:layout_marginVertical="4dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="2dp">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="16dp">

        <TextView
            android:id="@+id/tv_title"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:textColor="@color/text_primary"
            android:textSize="16sp"
            android:textStyle="bold"
            app:layout_constraintEnd_toStartOf="@+id/btn_delete"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            tools:text="示例标题" />

        <TextView
            android:id="@+id/tv_description"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginTop="4dp"
            android:textColor="@color/text_secondary"
            android:textSize="14sp"
            app:layout_constraintEnd_toEndOf="@+id/tv_title"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/tv_title"
            tools:text="这是一个示例描述" />

        <TextView
            android:id="@+id/tv_status"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:background="@drawable/bg_status"
            android:paddingHorizontal="8dp"
            android:paddingVertical="2dp"
            android:textSize="12sp"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/tv_description"
            tools:text="激活" />

        <TextView
            android:id="@+id/tv_time"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="8dp"
            android:textColor="@color/text_hint"
            android:textSize="12sp"
            app:layout_constraintBottom_toBottomOf="@+id/tv_status"
            app:layout_constraintStart_toEndOf="@+id/tv_status"
            app:layout_constraintTop_toTopOf="@+id/tv_status"
            tools:text="2小时前" />

        <ImageButton
            android:id="@+id/btn_delete"
            android:layout_width="32dp"
            android:layout_height="32dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/ic_delete"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:tint="@color/text_hint" />

    </androidx.constraintlayout.widget.ConstraintLayout>

</com.google.android.material.card.MaterialCardView>
```

#### 3.5.3 字符串资源

```xml
<!-- feature-example/src/main/res/values/strings.xml -->
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- 页面标题 -->
    <string name="example_list_title">示例列表</string>
    <string name="example_detail_title">示例详情</string>
    <string name="create_example_title">创建示例</string>
    <string name="edit_example_title">编辑示例</string>

    <!-- 按钮文本 -->
    <string name="btn_create">创建</string>
    <string name="btn_save">保存</string>
    <string name="btn_delete">删除</string>
    <string name="btn_cancel">取消</string>
    <string name="btn_confirm">确认</string>

    <!-- 提示信息 -->
    <string name="msg_create_success">创建成功</string>
    <string name="msg_update_success">更新成功</string>
    <string name="msg_delete_success">删除成功</string>
    <string name="msg_operation_failed">操作失败</string>

    <!-- 错误信息 -->
    <string name="error_network">网络连接失败</string>
    <string name="error_server">服务器错误</string>
    <string name="error_unknown">未知错误</string>

    <!-- 空状态 -->
    <string name="empty_example_list">暂无数据</string>
    <string name="empty_example_list_desc">点击右下角按钮创建第一个示例</string>

    <!-- 对话框 -->
    <string name="dialog_delete_title">确认删除</string>
    <string name="dialog_delete_message">确定要删除「%1$s」吗？</string>
</resources>
```

## 4. 模块依赖规则

### 4.1 依赖层次结构

Atlas框架的模块依赖遵循严格的层次结构：

```
app (应用层)
├── feature-* (功能层)
│   ├── core-ui (UI组件层)
│   ├── core-network (网络层)
│   ├── core-database (数据库层)
│   ├── core-model (模型层)
│   └── core-common (基础层)
└── core-* (核心层)
    └── core-model (模型层)
    └── core-common (基础层)
```

### 4.2 依赖规则

#### 4.2.1 允许的依赖关系

| 模块类型 | 可以依赖 | 说明 |
|---------|---------|------|
| app | feature-*, core-ui, core-common | 应用模块可以依赖所有模块 |
| feature-* | core-ui, core-network, core-database, core-model, core-common | 功能模块可以依赖所有核心模块 |
| core-ui | core-model, core-common | UI组件可以依赖模型和基础模块 |
| core-network | core-model, core-common | 网络层可以依赖模型和基础模块 |
| core-database | core-model, core-common | 数据库层可以依赖模型和基础模块 |
| core-model | 无 | 模型层不依赖其他模块 |
| core-common | 无 | 基础层不依赖其他模块 |

#### 4.2.2 禁止的依赖关系

- **循环依赖**: 任何模块都不能形成循环依赖
- **跨层依赖**: 不能跳过中间层直接依赖
- **功能模块互依赖**: feature-* 模块之间不能相互依赖
- **核心模块依赖功能模块**: core-* 模块不能依赖 feature-* 模块

#### 4.2.3 依赖检查脚本

创建依赖检查脚本来验证模块依赖关系：

```bash
#!/bin/bash
# scripts/check-dependencies.sh

echo "检查模块依赖关系..."

# 检查是否存在循环依赖
./gradlew :app:dependencies --configuration debugRuntimeClasspath > dependencies.txt

# 检查禁止的依赖模式
if grep -q "feature.*-> feature" dependencies.txt; then
    echo "❌ 发现功能模块间的相互依赖"
    exit 1
fi

if grep -q "core.*-> feature" dependencies.txt; then
    echo "❌ 发现核心模块依赖功能模块"
    exit 1
fi

echo "✅ 模块依赖关系检查通过"
rm dependencies.txt
```

### 4.3 模块间通信

#### 4.3.1 通过接口通信

功能模块间需要通信时，通过定义接口实现：

```kotlin
// core-common中定义接口
interface NavigationService {
    fun navigateToUserDetail(userId: Long)
    fun navigateToLogin()
}

// app模块中实现接口
@Singleton
class NavigationServiceImpl @Inject constructor() : NavigationService {
    override fun navigateToUserDetail(userId: Long) {
        // 导航实现
    }
    
    override fun navigateToLogin() {
        // 导航实现
    }
}

// feature模块中使用
class SomeViewModel @Inject constructor(
    private val navigationService: NavigationService
) : BaseViewModel() {
    
    fun onUserClick(userId: Long) {
        navigationService.navigateToUserDetail(userId)
    }
}
```

#### 4.3.2 通过事件总线通信

对于松耦合的通信，可以使用事件总线：

```kotlin
// core-common中定义事件
sealed class AppEvent {
    data class UserLoggedIn(val user: User) : AppEvent()
    object UserLoggedOut : AppEvent()
    data class DataUpdated(val type: String) : AppEvent()
}

// 发送事件
class LoginViewModel @Inject constructor(
    private val eventBus: EventBus
) : BaseViewModel() {
    
    fun onLoginSuccess(user: User) {
        eventBus.post(AppEvent.UserLoggedIn(user))
    }
}

// 接收事件
class HomeViewModel @Inject constructor(
    private val eventBus: EventBus
) : BaseViewModel() {
    
    init {
        eventBus.register<AppEvent.UserLoggedIn> { event ->
            handleUserLogin(event.user)
        }
    }
}
```## 5. 
模块测试

### 5.1 单元测试

#### 5.1.1 Repository测试

```kotlin
// feature-example/src/test/java/com/sword/atlas/feature/example/repository/ExampleRepositoryTest.kt
@RunWith(MockitoJUnitRunner::class)
class ExampleRepositoryTest {

    @Mock
    private lateinit var api: ExampleApi

    @Mock
    private lateinit var dao: ExampleDao

    private lateinit var repository: ExampleRepository

    @Before
    fun setup() {
        repository = ExampleRepository(api, dao)
    }

    @Test
    fun `getExampleListFlow should return cached data first`() = runTest {
        // Given
        val cachedExamples = listOf(
            ExampleEntity(1L, "Test 1", "Description 1", 1, "2023-01-01", "2023-01-01")
        )
        whenever(dao.getAllExamples()).thenReturn(flowOf(cachedExamples))

        // When
        val result = repository.getExampleListFlow(refresh = false).first()

        // Then
        assertTrue(result is Result.Success)
        assertEquals(1, (result as Result.Success).data.size)
        assertEquals("Test 1", result.data[0].title)
    }

    @Test
    fun `getExampleById should handle network error`() = runTest {
        // Given
        val exampleId = 1L
        whenever(api.getExampleById(exampleId)).thenThrow(IOException("Network error"))

        // When
        val result = repository.getExampleById(exampleId)

        // Then
        assertTrue(result is Result.Error)
        assertEquals(ErrorCode.NETWORK_ERROR, (result as Result.Error).code)
    }

    @Test
    fun `createExample should return success result`() = runTest {
        // Given
        val title = "New Example"
        val description = "New Description"
        val responseDto = ExampleDto(1L, title, description, 1, "2023-01-01", "2023-01-01")
        val apiResponse = ApiResponse(200, "Success", responseDto)
        
        whenever(api.createExample(any())).thenReturn(apiResponse)

        // When
        val result = repository.createExample(title, description)

        // Then
        assertTrue(result is Result.Success)
        assertEquals(title, (result as Result.Success).data.title)
        assertEquals(description, result.data.description)
    }
}
```

#### 5.1.2 ViewModel测试

```kotlin
// feature-example/src/test/java/com/sword/atlas/feature/example/ui/ExampleListViewModelTest.kt
@RunWith(MockitoJUnitRunner::class)
class ExampleListViewModelTest {

    @Mock
    private lateinit var repository: ExampleRepository

    private lateinit var viewModel: ExampleListViewModel

    private val testDispatcher = UnconfinedTestDispatcher()

    @Before
    fun setup() {
        Dispatchers.setMain(testDispatcher)
        viewModel = ExampleListViewModel(repository)
    }

    @After
    fun tearDown() {
        Dispatchers.resetMain()
    }

    @Test
    fun `loadExampleList should update state to loading then success`() = runTest {
        // Given
        val examples = listOf(
            Example(1L, "Test", "Description", ExampleStatus.ACTIVE, Date(), Date())
        )
        whenever(repository.getExampleListFlow(false))
            .thenReturn(flowOf(Result.Loading, Result.Success(examples)))

        // When
        viewModel.loadExampleList()

        // Then
        val states = mutableListOf<UiState<List<Example>>>()
        val job = launch {
            viewModel.exampleListState.collect { states.add(it) }
        }

        advanceUntilIdle()
        job.cancel()

        assertTrue(states.any { it is UiState.Loading })
        assertTrue(states.any { it is UiState.Success })
        assertEquals(examples, (states.last() as UiState.Success).data)
    }

    @Test
    fun `deleteExample should call repository and refresh list`() = runTest {
        // Given
        val example = Example(1L, "Test", "Description", ExampleStatus.ACTIVE, Date(), Date())
        whenever(repository.deleteExample(example.id)).thenReturn(Result.Success(Unit))
        whenever(repository.getExampleListFlow(true)).thenReturn(flowOf(Result.Success(emptyList())))

        // When
        viewModel.deleteExample(example)

        // Then
        verify(repository).deleteExample(example.id)
        verify(repository).getExampleListFlow(true)
    }
}
```

### 5.2 集成测试

#### 5.2.1 Fragment测试

```kotlin
// feature-example/src/androidTest/java/com/sword/atlas/feature/example/ui/ExampleListFragmentTest.kt
@HiltAndroidTest
@RunWith(AndroidJUnit4::class)
class ExampleListFragmentTest {

    @get:Rule
    var hiltRule = HiltAndroidRule(this)

    @Before
    fun setup() {
        hiltRule.inject()
    }

    @Test
    fun testExampleListDisplay() {
        // 启动Fragment
        launchFragmentInHiltContainer<ExampleListFragment>()

        // 验证UI显示
        onView(withId(R.id.recycler_view))
            .check(matches(isDisplayed()))

        onView(withId(R.id.fab_add))
            .check(matches(isDisplayed()))
    }

    @Test
    fun testSwipeRefresh() {
        launchFragmentInHiltContainer<ExampleListFragment>()

        // 执行下拉刷新
        onView(withId(R.id.swipe_refresh_layout))
            .perform(swipeDown())

        // 验证刷新状态
        onView(withId(R.id.swipe_refresh_layout))
            .check(matches(isDisplayed()))
    }

    @Test
    fun testFabClick() {
        launchFragmentInHiltContainer<ExampleListFragment>()

        // 点击FAB
        onView(withId(R.id.fab_add))
            .perform(click())

        // 验证导航（需要mock导航组件）
    }
}
```

#### 5.2.2 测试工具类

```kotlin
// feature-example/src/androidTest/java/com/sword/atlas/feature/example/util/TestUtil.kt
object TestUtil {

    fun createMockExample(
        id: Long = 1L,
        title: String = "Test Example",
        description: String = "Test Description"
    ): Example {
        return Example(
            id = id,
            title = title,
            description = description,
            status = ExampleStatus.ACTIVE,
            createdAt = Date(),
            updatedAt = Date()
        )
    }

    fun createMockExampleList(count: Int = 5): List<Example> {
        return (1..count).map { createMockExample(it.toLong(), "Example $it") }
    }
}

// 测试用的Hilt模块
@Module
@TestInstallIn(
    components = [SingletonComponent::class],
    replaces = [ExampleModule::class]
)
object TestExampleModule {

    @Provides
    @Singleton
    fun provideTestExampleRepository(): ExampleRepository {
        return mockk<ExampleRepository> {
            every { getExampleListFlow(any()) } returns flowOf(
                Result.Success(TestUtil.createMockExampleList())
            )
        }
    }
}
```

## 6. 开发最佳实践

### 6.1 代码组织

#### 6.1.1 包结构规范

```
com.sword.atlas.feature.example/
├── data/                    # 数据层
│   ├── api/                # API接口（按功能分组）
│   ├── model/              # 数据传输对象
│   └── repository/         # 数据仓库实现
├── domain/                 # 领域层（可选）
│   ├── model/              # 领域模型
│   └── usecase/            # 业务用例
├── ui/                     # 表现层
│   ├── {feature}/          # 按功能分组
│   │   ├── {Feature}Activity.kt
│   │   ├── {Feature}Fragment.kt
│   │   ├── {Feature}ViewModel.kt
│   │   └── {Feature}Adapter.kt
│   └── common/             # 通用UI组件
└── di/                     # 依赖注入
```

#### 6.1.2 文件命名规范

| 类型 | 命名规则 | 示例 |
|------|---------|------|
| Activity | {Feature}Activity | UserDetailActivity |
| Fragment | {Feature}Fragment | UserListFragment |
| ViewModel | {Feature}ViewModel | UserListViewModel |
| Adapter | {Feature}Adapter | UserListAdapter |
| Repository | {Feature}Repository | UserRepository |
| API | {Feature}Api | UserApi |
| Model | {Feature}Dto/Entity/Model | UserDto, UserEntity, User |

### 6.2 性能优化

#### 6.2.1 懒加载

```kotlin
// 延迟初始化重量级对象
class ExampleRepository @Inject constructor(
    private val api: ExampleApi,
    private val dao: ExampleDao
) {
    private val cache by lazy { LruCache<Long, Example>(50) }
    
    private val gson by lazy { 
        GsonBuilder()
            .setDateFormat("yyyy-MM-dd HH:mm:ss")
            .create()
    }
}
```

#### 6.2.2 内存优化

```kotlin
// 使用对象池复用ViewHolder
class ExampleListAdapter : BaseAdapter<Example, ExampleListAdapter.ViewHolder>() {
    
    private val viewHolderPool = RecyclerView.RecycledViewPool()
    
    override fun onAttachedToRecyclerView(recyclerView: RecyclerView) {
        super.onAttachedToRecyclerView(recyclerView)
        recyclerView.setRecycledViewPool(viewHolderPool)
    }
}

// 及时释放资源
class ExampleDetailFragment : BaseVMFragment<FragmentExampleDetailBinding, ExampleDetailViewModel>() {
    
    private var imageLoader: ImageLoader? = null
    
    override fun onDestroyView() {
        super.onDestroyView()
        imageLoader?.cancel()
        imageLoader = null
    }
}
```

#### 6.2.3 网络优化

```kotlin
// 请求去重
class ExampleRepository @Inject constructor(
    private val api: ExampleApi
) {
    private val ongoingRequests = mutableMapOf<String, Deferred<Result<Example>>>()
    
    suspend fun getExampleById(id: Long): Result<Example> {
        val key = "example_$id"
        
        return ongoingRequests[key]?.await() ?: run {
            val deferred = GlobalScope.async {
                executeRequest { api.getExampleById(id) }
            }
            ongoingRequests[key] = deferred
            
            try {
                deferred.await()
            } finally {
                ongoingRequests.remove(key)
            }
        }
    }
}
```

### 6.3 错误处理

#### 6.3.1 统一错误处理

```kotlin
// 在BaseViewModel中统一处理错误
abstract class BaseViewModel : ViewModel() {
    
    protected fun handleError(error: Throwable): UiState.Error {
        return when (error) {
            is HttpException -> {
                when (error.code()) {
                    401 -> UiState.Error(ErrorCode.UNAUTHORIZED, "登录已过期")
                    403 -> UiState.Error(ErrorCode.FORBIDDEN, "权限不足")
                    404 -> UiState.Error(ErrorCode.NOT_FOUND, "资源不存在")
                    else -> UiState.Error(error.code(), error.message())
                }
            }
            is IOException -> UiState.Error(ErrorCode.NETWORK_ERROR, "网络连接失败")
            else -> UiState.Error(ErrorCode.UNKNOWN_ERROR, error.message ?: "未知错误")
        }
    }
}
```

#### 6.3.2 用户友好的错误提示

```kotlin
// 在Fragment中处理错误显示
override fun observeData() {
    viewModel.errorState.collectOnMain(this) { error ->
        when (error.code) {
            ErrorCode.NETWORK_ERROR -> {
                binding.stateLayout.showError("网络连接失败") {
                    viewModel.retry()
                }
            }
            ErrorCode.UNAUTHORIZED -> {
                showLoginDialog()
            }
            else -> {
                toast(error.message)
            }
        }
    }
}
```

### 6.4 日志和调试

#### 6.4.1 结构化日志

```kotlin
// 使用结构化日志
class ExampleRepository @Inject constructor() {
    
    companion object {
        private const val TAG = "ExampleRepository"
    }
    
    suspend fun getExampleById(id: Long): Result<Example> {
        LogUtil.d(TAG, "getExampleById: id=$id")
        
        return try {
            val result = executeRequest { api.getExampleById(id) }
            LogUtil.d(TAG, "getExampleById: success, example=${result.data?.title}")
            result
        } catch (e: Exception) {
            LogUtil.e(TAG, "getExampleById: failed", e)
            Result.Error(ErrorCode.NETWORK_ERROR, e.message ?: "网络错误")
        }
    }
}
```

#### 6.4.2 调试工具

```kotlin
// Debug模式下的额外功能
class ExampleListViewModel @Inject constructor(
    private val repository: ExampleRepository
) : BaseViewModel() {
    
    init {
        if (BuildConfig.DEBUG) {
            // 添加调试信息
            viewModelScope.launch {
                exampleListState.collect { state ->
                    LogUtil.d("ExampleListViewModel", "State changed: $state")
                }
            }
        }
    }
}
```## 7
. 模块发布和版本管理

### 7.1 模块版本控制

#### 7.1.1 版本号规范

采用语义化版本控制（Semantic Versioning）：

```
MAJOR.MINOR.PATCH

MAJOR: 不兼容的API修改
MINOR: 向后兼容的功能性新增
PATCH: 向后兼容的问题修正
```

#### 7.1.2 版本配置

```kotlin
// feature-example/build.gradle.kts
android {
    defaultConfig {
        // 模块版本信息
        buildConfigField("String", "MODULE_VERSION", "\"1.2.3\"")
        buildConfigField("String", "MODULE_NAME", "\"feature-example\"")
        buildConfigField("long", "BUILD_TIME", "${System.currentTimeMillis()}L")
    }
}
```

### 7.2 模块文档

#### 7.2.1 README模板

为每个功能模块创建README.md：

```markdown
# Feature Example Module

## 概述

示例功能模块，展示如何在Atlas框架中实现标准的CRUD功能。

## 功能特性

- ✅ 示例列表展示
- ✅ 示例详情查看
- ✅ 创建新示例
- ✅ 编辑示例
- ✅ 删除示例
- ✅ 下拉刷新
- ✅ 状态管理

## 技术实现

- **架构**: MVVM + Repository Pattern
- **UI**: Fragment + RecyclerView + ViewBinding
- **网络**: Retrofit + Coroutines
- **数据库**: Room + Flow
- **依赖注入**: Hilt

## API接口

| 接口 | 方法 | 说明 |
|------|------|------|
| /examples | GET | 获取示例列表 |
| /examples/{id} | GET | 获取示例详情 |
| /examples | POST | 创建示例 |
| /examples/{id} | PUT | 更新示例 |
| /examples/{id} | DELETE | 删除示例 |

## 使用方法

### 1. 添加依赖

```kotlin
// app/build.gradle.kts
dependencies {
    implementation(project(":feature-example"))
}
```

### 2. 导航到模块

```kotlin
// 导航到示例列表
findNavController().navigate(R.id.action_to_example_list)

// 导航到示例详情
findNavController().navigate(
    ExampleListFragmentDirections.actionToExampleDetail(exampleId)
)
```

## 测试

```bash
# 运行单元测试
./gradlew :feature-example:testDebugUnitTest

# 运行集成测试
./gradlew :feature-example:connectedDebugAndroidTest
```

## 更新日志

### v1.2.3 (2023-10-09)
- 修复列表刷新问题
- 优化内存使用

### v1.2.0 (2023-10-01)
- 新增批量删除功能
- 支持搜索过滤

### v1.1.0 (2023-09-15)
- 新增示例状态管理
- 优化UI交互

### v1.0.0 (2023-09-01)
- 初始版本发布
```

#### 7.2.2 API文档

```markdown
# Example API Documentation

## 数据模型

### Example

```json
{
  "id": 1,
  "title": "示例标题",
  "description": "示例描述",
  "status": 1,
  "createdAt": "2023-10-09T10:00:00Z",
  "updatedAt": "2023-10-09T10:00:00Z"
}
```

### 状态码

| 值 | 状态 | 说明 |
|----|------|------|
| 0 | DRAFT | 草稿 |
| 1 | ACTIVE | 激活 |
| 2 | INACTIVE | 停用 |

## 接口详情

### 获取示例列表

**请求**
```
GET /examples?page=1&size=20
```

**响应**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "items": [...],
    "total": 100,
    "page": 1,
    "size": 20
  }
}
```
```

## 8. 常见问题和解决方案

### 8.1 编译问题

#### 8.1.1 依赖冲突

**问题**: 模块间依赖版本冲突

**解决方案**:
```kotlin
// 在根build.gradle.kts中统一版本
configurations.all {
    resolutionStrategy {
        force("com.squareup.okhttp3:okhttp:4.12.0")
        force("com.google.code.gson:gson:2.11.0")
    }
}
```

#### 8.1.2 循环依赖

**问题**: 模块间出现循环依赖

**解决方案**:
1. 将共同依赖提取到core模块
2. 使用接口解耦
3. 重新设计模块边界

### 8.2 运行时问题

#### 8.2.1 Hilt注入失败

**问题**: @AndroidEntryPoint注解的类无法注入依赖

**解决方案**:
```kotlin
// 确保Application类添加@HiltAndroidApp
@HiltAndroidApp
class App : Application()

// 确保模块正确配置Hilt
@Module
@InstallIn(SingletonComponent::class)
object ExampleModule {
    // ...
}
```

#### 8.2.2 ViewBinding空指针

**问题**: Fragment中binding为空

**解决方案**:
```kotlin
class ExampleFragment : Fragment() {
    private var _binding: FragmentExampleBinding? = null
    private val binding get() = _binding!!
    
    override fun onCreateView(...): View? {
        _binding = FragmentExampleBinding.inflate(inflater, container, false)
        return binding.root
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```

### 8.3 性能问题

#### 8.3.1 列表滑动卡顿

**问题**: RecyclerView滑动不流畅

**解决方案**:
```kotlin
// 优化ViewHolder创建
class ExampleAdapter : BaseAdapter<Example, ViewHolder>() {
    
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        // 使用LayoutInflater.from(parent.context)而不是activity的inflater
        val binding = ItemExampleBinding.inflate(
            LayoutInflater.from(parent.context), parent, false
        )
        return ViewHolder(binding)
    }
    
    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        // 避免在bind中创建对象
        holder.bind(getItem(position))
    }
}
```

#### 8.3.2 内存泄漏

**问题**: Activity/Fragment内存泄漏

**解决方案**:
```kotlin
class ExampleViewModel : BaseViewModel() {
    
    private var job: Job? = null
    
    fun loadData() {
        job?.cancel()
        job = viewModelScope.launch {
            // 异步操作
        }
    }
    
    override fun onCleared() {
        super.onCleared()
        job?.cancel()
    }
}
```

## 9. 开发工具和脚本

### 9.1 模块生成脚本

创建自动化脚本生成新模块：

```bash
#!/bin/bash
# scripts/create-feature-module.sh

MODULE_NAME=$1
PACKAGE_NAME="com.sword.atlas.feature.${MODULE_NAME}"

if [ -z "$MODULE_NAME" ]; then
    echo "Usage: ./create-feature-module.sh <module-name>"
    exit 1
fi

echo "Creating feature module: feature-$MODULE_NAME"

# 创建目录结构
mkdir -p "feature-$MODULE_NAME/src/main/java/com/sword/atlas/feature/$MODULE_NAME"
mkdir -p "feature-$MODULE_NAME/src/main/res/layout"
mkdir -p "feature-$MODULE_NAME/src/main/res/values"
mkdir -p "feature-$MODULE_NAME/src/test/java"
mkdir -p "feature-$MODULE_NAME/src/androidTest/java"

# 创建build.gradle.kts
cat > "feature-$MODULE_NAME/build.gradle.kts" << EOF
plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.hilt)
    kotlin("kapt")
}

android {
    namespace = "$PACKAGE_NAME"
    compileSdk = libs.versions.compileSdk.get().toInt()

    defaultConfig {
        minSdk = libs.versions.minSdk.get().toInt()
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
        consumerProguardFiles("consumer-rules.pro")
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }

    buildFeatures {
        viewBinding = true
    }
}

dependencies {
    implementation(project(":core-ui"))
    implementation(project(":core-network"))
    implementation(project(":core-database"))
    implementation(project(":core-model"))
    implementation(project(":core-common"))

    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.viewmodel.ktx)
    implementation(libs.androidx.fragment.ktx)
    implementation(libs.kotlinx.coroutines.android)
    implementation(libs.hilt.android)
    kapt(libs.hilt.compiler)

    testImplementation(libs.junit)
    testImplementation(libs.mockito.core)
    testImplementation(libs.kotlinx.coroutines.test)
    
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    androidTestImplementation(libs.hilt.android.testing)
    kaptAndroidTest(libs.hilt.compiler)
}
EOF

# 更新settings.gradle.kts
echo "include(\":feature-$MODULE_NAME\")" >> settings.gradle.kts

echo "✅ Module feature-$MODULE_NAME created successfully!"
echo "📝 Don't forget to add the module to app/build.gradle.kts dependencies"
```

### 9.2 代码质量检查

```bash
#!/bin/bash
# scripts/quality-check.sh

echo "🔍 Running code quality checks..."

# Lint检查
echo "Running Android Lint..."
./gradlew lintDebug

# Detekt静态分析
echo "Running Detekt..."
./gradlew detekt

# 单元测试
echo "Running unit tests..."
./gradlew testDebugUnitTest

# 测试覆盖率
echo "Generating test coverage report..."
./gradlew jacocoTestReport

echo "✅ Quality checks completed!"
```

## 10. 总结

### 10.1 模块开发检查清单

在完成模块开发后，请确保通过以下检查：

#### 基础结构
- [ ] 模块目录结构符合规范
- [ ] build.gradle.kts配置正确
- [ ] 依赖关系符合架构要求
- [ ] 包名和命名规范正确

#### 代码质量
- [ ] 遵循编码规范
- [ ] 所有公开API有文档注释
- [ ] 错误处理完善
- [ ] 内存泄漏检查通过

#### 功能实现
- [ ] MVVM架构实现正确
- [ ] Repository模式使用恰当
- [ ] 依赖注入配置完整
- [ ] UI状态管理合理

#### 测试覆盖
- [ ] 单元测试覆盖核心逻辑
- [ ] 集成测试验证UI交互
- [ ] 测试用例命名清晰
- [ ] Mock对象使用合理

#### 文档完善
- [ ] README文档完整
- [ ] API文档准确
- [ ] 更新日志维护
- [ ] 使用示例清晰

### 10.2 最佳实践总结

1. **保持模块独立**: 每个功能模块应该能够独立开发、测试和部署
2. **遵循架构规范**: 严格按照MVVM + Repository模式实现
3. **注重代码质量**: 使用静态分析工具，保持高代码质量
4. **完善测试覆盖**: 单元测试和集成测试并重
5. **文档先行**: 先设计API和接口，再实现具体功能
6. **性能优先**: 时刻关注内存使用和性能表现
7. **用户体验**: 提供友好的错误提示和加载状态

### 10.3 持续改进

模块开发是一个持续改进的过程：

- **定期重构**: 根据业务变化调整模块结构
- **性能优化**: 持续监控和优化性能瓶颈
- **技术升级**: 跟进新技术，适时升级依赖
- **经验总结**: 将开发经验沉淀为最佳实践
- **团队协作**: 建立代码审查和知识分享机制

通过遵循本指南，开发团队可以高效地创建高质量、可维护的功能模块，为Atlas框架的持续发展奠定坚实基础。

---

**本指南持续更新，最后更新时间：2025-10-09**