# Androidè·¯ç”±æ¡†æ¶åŸç†æ€»è§ˆ

## ğŸ“š åŸç†æ–‡æ¡£å¯¼èˆª

æœ¬è·¯ç”±æ¡†æ¶çš„æŠ€æœ¯åŸç†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼Œå»ºè®®æŒ‰é¡ºåºé˜…è¯»ï¼š

1. **[æ ¸å¿ƒæ¶æ„åŸç†](ARCHITECTURE_PRINCIPLES.md)** - æ•´ä½“æ¶æ„è®¾è®¡å’Œæ ¸å¿ƒç»„ä»¶
2. **[æ‹¦æˆªå™¨ç³»ç»ŸåŸç†](INTERCEPTOR_PRINCIPLES.md)** - è´£ä»»é“¾æ¨¡å¼å’Œæ‹¦æˆªå™¨æœºåˆ¶
3. **[æ³¨è§£å¤„ç†åŸç†](ANNOTATION_PRINCIPLES.md)** - æ³¨è§£æ‰«æå’Œè·¯ç”±æ³¨å†Œæœºåˆ¶
4. **[å‚æ•°ä¼ é€’åŸç†](PARAMETER_PRINCIPLES.md)** - Bundleå¤„ç†å’Œç±»å‹å®‰å…¨å‚æ•°ä¼ é€’
5. **[å¼‚æ­¥å¤„ç†å’Œä¾èµ–æ³¨å…¥åŸç†](ASYNC_DI_PRINCIPLES.md)** - åç¨‹å¼‚æ­¥å’ŒHilté›†æˆ

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚                                â”‚
â”‚  Router.with(context).to("/profile").withString().go()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¡†æ¶å±‚                                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Router    â”‚  â”‚ RouteRequestâ”‚  â”‚ NavigationCallback  â”‚  â”‚
â”‚  â”‚   (å…¥å£)    â”‚  â”‚  (è¯·æ±‚å¯¹è±¡) â”‚  â”‚   (å›è°ƒå¤„ç†)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RouteTable  â”‚  â”‚Interceptor  â”‚  â”‚AnnotationProcessor â”‚  â”‚
â”‚  â”‚ (è·¯ç”±è¡¨)    â”‚  â”‚ Manager     â”‚  â”‚  (æ³¨è§£å¤„ç†å™¨)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚BundleBuilderâ”‚  â”‚CallbackHandlerâ”‚ â”‚ RouteResultManager â”‚  â”‚
â”‚  â”‚ (å‚æ•°æ„å»º)  â”‚  â”‚ (å›è°ƒå¤„ç†)   â”‚  â”‚   (ç»“æœç®¡ç†)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Androidç³»ç»Ÿå±‚                             â”‚
â”‚  Intent + Bundle + startActivity + ActivityResult          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å®Œæ•´å¯¼èˆªæµç¨‹

```
ç”¨æˆ·è°ƒç”¨
Router.with(context).to("/profile").withString("userId", "123").go()
                    â”‚
                    â–¼
            åˆ›å»ºRouteRequestå¯¹è±¡
            - context: Context
            - path: "/profile"  
            - bundle: Bundle{userId="123"}
                    â”‚
                    â–¼
         AnnotationProcessoræ‰«ææ³¨å†Œ
         "/profile" -> ProfileActivity.class
                    â”‚
                    â–¼
            InterceptorManageræ‰§è¡Œæ‹¦æˆªå™¨é“¾
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ LogInterceptor (priority: 1000) â”‚ â”€â”€â”
            â”‚ LoginInterceptor (priority: 800)â”‚   â”‚ æŒ‰ä¼˜å…ˆçº§
            â”‚ PermissionInterceptor (priority:â”‚   â”‚ é¡ºåºæ‰§è¡Œ
            â”‚ 600)                            â”‚ â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚
        æ‹¦æˆªå™¨è¿”å›true    æ‹¦æˆªå™¨è¿”å›false
            â”‚               â”‚
            â–¼               â–¼
        ç»§ç»­å¯¼èˆª          ä¸­æ–­å¯¼èˆª
            â”‚           è°ƒç”¨onErrorå›è°ƒ
            â–¼
        RouteTableæŸ¥æ‰¾Activityç±»
        "/profile" -> ProfileActivity.class
            â”‚
            â–¼
        æ„å»ºIntentå¯¹è±¡
        Intent(context, ProfileActivity.class)
        intent.putExtras(bundle)
            â”‚
            â–¼
        æ‰§è¡ŒstartActivity()
            â”‚
            â–¼
        CallbackHandleræ‰§è¡ŒæˆåŠŸå›è°ƒ
        callback.onSuccess("/profile")
```

## ğŸ§© æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. å»ºé€ è€…æ¨¡å¼ (Builder Pattern)
```kotlin
Router.with(context)          // åˆ›å»ºå»ºé€ è€…
    .to("/profile")           // è®¾ç½®è·¯å¾„
    .withString("id", "123")  // æ·»åŠ å‚æ•°
    .withCallback(callback)   // è®¾ç½®å›è°ƒ
    .go()                     // æ‰§è¡Œæ„å»º
```

### 2. è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)
```kotlin
// æ‹¦æˆªå™¨é“¾æŒ‰ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œ
LogInterceptor -> LoginInterceptor -> PermissionInterceptor -> å¯¼èˆªæ‰§è¡Œ
```

### 3. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)
```kotlin
// å¯¼èˆªå›è°ƒé€šçŸ¥
interface NavigationCallback {
    fun onSuccess(path: String)
    fun onError(exception: Exception)
}
```

### 4. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
```kotlin
// é€šè¿‡Hiltå®ç°çš„å•ä¾‹ç»„ä»¶
@Singleton
class Router @Inject constructor(...)
```

### 5. å·¥å‚æ¨¡å¼ (Factory Pattern)
```kotlin
// RouterModuleä½œä¸ºå·¥å‚åˆ›å»ºå„ç§ç»„ä»¶
@Provides
@Singleton
fun provideRouter(...): Router = Router(...)
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. è·¯ç”±è¡¨ç¼“å­˜
- ä½¿ç”¨ConcurrentHashMapå­˜å‚¨è·¯å¾„æ˜ å°„
- é¿å…é‡å¤çš„æ³¨è§£æ‰«æ
- æ”¯æŒå¢é‡æ³¨å†Œ

### 2. æ‹¦æˆªå™¨ä¼˜åŒ–
- æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œé«˜ä¼˜å…ˆçº§å…ˆæ‰§è¡Œ
- æ”¯æŒå¼‚æ­¥æ‹¦æˆªå™¨ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- æ‹¦æˆªå™¨ç»“æœç¼“å­˜

### 3. å‚æ•°ä¼ é€’ä¼˜åŒ–
- Bundleå¯¹è±¡æ± å¤ç”¨
- å¤§å‚æ•°å‹ç¼©ä¼ è¾“
- ç±»å‹å®‰å…¨çš„ç¼–è¯‘æ—¶æ£€æŸ¥

### 4. å¼‚æ­¥å¤„ç†ä¼˜åŒ–
- åç¨‹æ± ç®¡ç†
- ä¸»çº¿ç¨‹å’ŒIOçº¿ç¨‹åˆç†åˆ†å·¥
- å›è°ƒè‡ªåŠ¨æ¸…ç†é˜²æ­¢å†…å­˜æ³„æ¼

### 5. ä¾èµ–æ³¨å…¥ä¼˜åŒ–
- å•ä¾‹æ¨¡å¼å‡å°‘å¯¹è±¡åˆ›å»º
- æ‡’åŠ è½½éæ ¸å¿ƒç»„ä»¶
- ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨ç®¡ç†

## ğŸ”’ çº¿ç¨‹å®‰å…¨ä¿è¯

### 1. è·¯ç”±è¡¨çº¿ç¨‹å®‰å…¨
```kotlin
class RouteTable {
    // ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMap
    private val routes = ConcurrentHashMap<String, Class<out Activity>>()
}
```

### 2. æ‹¦æˆªå™¨ç®¡ç†çº¿ç¨‹å®‰å…¨
```kotlin
class InterceptorManager {
    // å…¨å±€æ‹¦æˆªå™¨ä½¿ç”¨åŒæ­¥å—ä¿æŠ¤
    private val globalInterceptors = mutableListOf<RouteInterceptor>()
    
    fun addGlobalInterceptor(interceptor: RouteInterceptor) {
        synchronized(globalInterceptors) {
            globalInterceptors.add(interceptor)
            globalInterceptors.sortBy { it.priority }
        }
    }
}
```

### 3. å›è°ƒå¤„ç†çº¿ç¨‹å®‰å…¨
```kotlin
class CallbackHandler {
    // ä½¿ç”¨ä¸»çº¿ç¨‹Handlerç¡®ä¿å›è°ƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
    private val mainHandler = Handler(Looper.getMainLooper())
}
```

## ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶

### 1. å¼‚å¸¸ç±»å‹å±‚æ¬¡
```kotlin
sealed class RouteException(message: String, cause: Throwable? = null) : Exception(message, cause) {
    class PathNotFoundException(path: String) : RouteException("è·¯å¾„æœªæ‰¾åˆ°: $path")
    class ActivityNotFoundException(path: String) : RouteException("Activityæœªæ‰¾åˆ°: $path")
    class InvalidPathException(path: String) : RouteException("æ— æ•ˆè·¯å¾„: $path")
    class PathConflictException(message: String) : RouteException(message)
    class InterceptedException(path: String) : RouteException("å¯¼èˆªè¢«æ‹¦æˆª: $path")
    class NavigationException(message: String, cause: Throwable? = null) : RouteException(message, cause)
}
```

### 2. é™çº§å¤„ç†
```kotlin
class FallbackHandler {
    fun handleNavigationFailure(request: RouteRequest, exception: Exception) {
        when (exception) {
            is RouteException.PathNotFoundException -> {
                // è·³è½¬åˆ°404é¡µé¢
                navigateToNotFoundPage(request.context)
            }
            is RouteException.InterceptedException -> {
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                navigateToLoginPage(request.context, request.path)
            }
            else -> {
                // æ˜¾ç¤ºé€šç”¨é”™è¯¯æç¤º
                showErrorDialog(request.context, exception.message)
            }
        }
    }
}
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### 1. æ—¥å¿—ç³»ç»Ÿ
```kotlin
class LogInterceptor : RouteInterceptor {
    override suspend fun intercept(request: RouteRequest): Boolean {
        val startTime = System.currentTimeMillis()
        
        LogUtil.d("Router", """
            å¯¼èˆªå¼€å§‹:
            è·¯å¾„: ${request.path}
            å‚æ•°: ${request.bundle.keySet().joinToString(", ")}
            ä¸Šä¸‹æ–‡: ${request.context::class.simpleName}
        """.trimIndent())
        
        return true
    }
}
```

### 2. æ€§èƒ½ç›‘æ§
```kotlin
class PerformanceMonitor {
    fun trackNavigation(path: String, duration: Long, success: Boolean) {
        Analytics.track("route_navigation", mapOf(
            "path" to path,
            "duration" to duration,
            "success" to success,
            "timestamp" to System.currentTimeMillis()
        ))
    }
}
```

### 3. è·¯ç”±ç»Ÿè®¡
```kotlin
class RouteStatistics {
    private val navigationCounts = ConcurrentHashMap<String, AtomicInteger>()
    private val errorCounts = ConcurrentHashMap<String, AtomicInteger>()
    
    fun recordNavigation(path: String) {
        navigationCounts.getOrPut(path) { AtomicInteger(0) }.incrementAndGet()
    }
    
    fun recordError(path: String) {
        errorCounts.getOrPut(path) { AtomicInteger(0) }.incrementAndGet()
    }
    
    fun getStatistics(): Map<String, NavigationStats> {
        return navigationCounts.mapValues { (path, count) ->
            NavigationStats(
                path = path,
                totalNavigations = count.get(),
                errorCount = errorCounts[path]?.get() ?: 0
            )
        }
    }
}
```

## ğŸ”§ æ‰©å±•ç‚¹

### 1. è‡ªå®šä¹‰æ‹¦æˆªå™¨
```kotlin
class CustomInterceptor : RouteInterceptor {
    override val priority: Int = 500
    override suspend fun intercept(request: RouteRequest): Boolean {
        // è‡ªå®šä¹‰æ‹¦æˆªé€»è¾‘
        return true
    }
}
```

### 2. è‡ªå®šä¹‰å‚æ•°å¤„ç†
```kotlin
class CustomRouteRequest : RouteRequest {
    fun withCustomObject(key: String, obj: CustomObject): RouteRequest {
        // è‡ªå®šä¹‰å¯¹è±¡åºåˆ—åŒ–
        val json = CustomSerializer.serialize(obj)
        return withString(key, json)
    }
}
```

### 3. è‡ªå®šä¹‰å¯¼èˆªç­–ç•¥
```kotlin
class CustomNavigationStrategy : NavigationStrategy {
    override fun navigate(context: Context, intent: Intent): Boolean {
        // è‡ªå®šä¹‰å¯¼èˆªé€»è¾‘ï¼Œå¦‚Fragmentå¯¼èˆª
        return true
    }
}
```

## ğŸ“ˆ æ¡†æ¶ä¼˜åŠ¿æ€»ç»“

1. **ç®€å•æ˜“ç”¨**: é“¾å¼è°ƒç”¨APIï¼Œå­¦ä¹ æˆæœ¬ä½
2. **åŠŸèƒ½å¼ºå¤§**: æ”¯æŒæ‹¦æˆªå™¨ã€å›è°ƒã€å¼‚æ­¥ç­‰é«˜çº§åŠŸèƒ½
3. **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
4. **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œå¯¼èˆªè€—æ—¶<100ms
5. **å¯æ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰æ‹¦æˆªå™¨ã€å‚æ•°å¤„ç†ç­‰æ‰©å±•
6. **çº¿ç¨‹å®‰å…¨**: å…¨é¢çš„çº¿ç¨‹å®‰å…¨ä¿è¯
7. **å†…å­˜å®‰å…¨**: é˜²æ­¢å†…å­˜æ³„æ¼çš„è®¾è®¡
8. **æ˜“è°ƒè¯•**: å®Œå–„çš„æ—¥å¿—å’Œç›‘æ§ç³»ç»Ÿ
9. **å…¼å®¹æ€§å¥½**: æ”¯æŒAndroid API 24+
10. **é›†æˆç®€å•**: ä¸Hiltæ— ç¼é›†æˆ

è¿™ä¸ªè·¯ç”±æ¡†æ¶é€šè¿‡ç²¾å¿ƒçš„æ¶æ„è®¾è®¡å’Œå®ç°ï¼Œä¸ºAndroidåº”ç”¨æä¾›äº†ä¸€å¥—å®Œæ•´ã€é«˜æ•ˆã€æ˜“ç”¨çš„é¡µé¢å¯¼èˆªè§£å†³æ–¹æ¡ˆã€‚